global    
    log 127.0.0.1   local0
    cpu-map 1-4 0-3
    chroot /opt/bitnami/haproxy
    mworker-max-reloads 3
    maxconn 256
    uid 99
    gid 99
    user root
    hard-stop-after 100s
    pidfile     ./haproxy.pidfile
    stats socket /tmp/haproxy
    set-dumpable
    server-state-file /etc/haproxy/state/current
    setenv IMAGEFILEENDINGS ".gif .jpg .png"
    strict-limits
    no busy-polling
    spread-checks 5
    max-spread-checks 15000
    maxcompcpuusage 90

defaults
    grace 10s
    load-server-state-from-file global
    compression algo identity
    
frontend http-in
    bind *:80
    timeout client 60s
    default_backend flask
    capture cookie ASPSESSION len 32

backend flask
    timeout connect 10s
    timeout server 100s
    mode tcp
    fullconn 10000
    balance roundrobin
    server web1 python-flask-1:8080
    server web2 python-flask-2:8080
        
